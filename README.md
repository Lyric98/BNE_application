# BNE_application

## Installation

To install requirements:
```
$ conda env update -f environment.yml
$ conda activate BNE
```
This environment includes all necessary dependencies.

To create an `BNE` executable to run experiments, run `pip install -e .`.

## Data

For prediction files of air pollution models (MH2021, GS2018, and SK2020 to be used as base models for BNE ensemble), the dataset can be requested by following instructions of the respective websites:


* MH2021 (Aaron von Donkelaar's group's model)
Hammer, M. S.; van Donkelaar, A.; Li, C.; Lyapustin, A.; Sayer, A. M.; Hsu, N. C.; Levy, R. C.; Garay, M. J.; Kalashnikova, O. V.; Kahn, R. A.; Brauer, M.; Apte, J. S.; Henze, D. K.; Zhang, L.; Zhang, Q.; Ford, B.; Pierce, J. R.; and Martin, R. V., Global Estimates and Long-Term Trends of Fine Particulate Matter Concentrations (1998-2018)., Environ. Sci. Technol, doi: 10.1021/acs.est.0c01764, 2020.
https://sites.wustl.edu/acag/datasets/surface-pm2-5/ 


* GS2018 (Global Burden of Disease)
Shaddick, Gavin, et al. "Data integration for the assessment of population exposure to ambient air pollution for global burden of disease assessment." Environmental science & technology 52.16 (2018): 9069-9078.
https://pubs.acs.org/doi/10.1021/acs.est.8b02864 


* GS2018 (Center for Air, Climate, and Energy Solutions)
Kim S.-Y.; Bechle, M.; Hankey, S.; Sheppard, L.; Szpiro, A. A.; Marshall, J. D. 2020. “Concentrations of criteria pollutants in the contiguous U.S., 1979 – 2015: Role of prediction model parsimony in integrated empirical geographic regression.” PLoS ONE 15(2), e0228535. DOI: 10.1371/journal.pone.0228535
https://www.caces.us/data 


Additionally, the processed version of the three base models’ prediction dataset are included in 
https://github.com/Lyric98/BNE_application/blob/master/data/training_dataset/training_eastMA.csv 



## Instructions for Use

### Reproducibility 
Each Jupyter-notebook file (.ipynb) or Python file (.py) can be run independently to generate the examples, simulation experiment, or the case study. The R code can be run to prepare the data for the case study. Note that base data refers to data that the base models are trained on; train data refers to data that the ensemble is trained on, and test data refers to data that the ensemble is evaluated on. 

`BNE_examine.ipynb` includes all simulation codes (1D/2D toy models).

For the case study experiments, Table 4 and Table S3 are generated diretly from `DirectlyEnsembles.ipynb`; Figure 4, Figure 5 and Figure S1 are generated by `BNE_1213.ipynb` and `BNE_spatialCV.ipynb`.

### Tuning Hyperparameters
```
python BNE_tune.py --bma_gp_lengthscale .05 --bma_gp_l2_regularizer 0.09 --bne_gp_lengthscale 4 --bne_gp_l2_regularizer 5
```

